---
title: å‰ç«¯è·å–wmaæ–‡ä»¶æ—¶é•¿
category: å…¶ä»–
tag: è§£å†³æ–¹æ¡ˆ
---

**ç®€ä»‹**

> wma æ˜¯å¾®è½¯æ¨å‡ºçš„ä¸€ç§éŸ³é¢‘å­˜å‚¨æ ¼å¼ï¼Œç”±äºç‰ˆæƒé—®é¢˜ï¼Œç›®å‰æµè§ˆå™¨çš„ audio/vedio æ ‡ç­¾éƒ½ä¸æ”¯æŒæ’­æ”¾ wma æ–‡ä»¶ï¼Œç”±äºé¡¹ç›®éœ€æ±‚éœ€è¦å‰ç«¯è¯»å–æœ¬åœ°éŸ³é¢‘æ—¶é•¿ç­‰ç›¸å…³ä¿¡æ¯ä¼ åˆ°åç«¯ï¼Œæ‰€ä»¥åªèƒ½å¦è¾Ÿè¹Šå¾„ã€‚

**æ€è·¯**

> è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ ¹æ®æ–‡ä»¶å¤´æ¥è§£ææ–‡ä»¶å±æ€§ä¿¡æ¯ï¼Œè·å–éŸ³é¢‘æ—¶é•¿

ä¸‹å›¾ä¸ºé€šè¿‡ windows media å·¥å…·æ¥è¯»å– wma æ–‡ä»¶ï¼Œåˆ†ææ–‡ä»¶å†…å®¹ç»„æˆ
![](/images/other/å‰ç«¯jsè·å–wmaæ–‡ä»¶æ—¶é•¿/1.png)

**ç»è¿‡å¤šä¸ªæ–‡ä»¶åˆ†æå¯¹æ¯”ï¼Œå¾—å‡ºå¦‚ä¸‹ç»“æœ:**

1. å¤´å¯¹è±¡ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆ
2. ä¸åŒæ–‡ä»¶ï¼Œå¤´éƒ¨å¤§å°ä¸ä¸€æ ·ï¼Œå¤´å¯¹è±¡ç»„æˆéƒ¨åˆ†ä¸ªæ•°ä¸ä¸€æ ·ï¼Œç»„æˆéƒ¨åˆ†æ’åˆ—é¡ºåºä¹Ÿä¸ä¸€æ ·
3. æ–‡ä»¶å±æ€§å†…å®¹å›ºå®šï¼ŒObject ID éƒ½ä¸€æ ·ï¼ˆæ–‡ä»¶æ—¶é•¿ç›¸å…³ä¿¡æ¯åœ¨æ­¤ï¼‰
4. æ–‡ä»¶çš„å‰ 30 ä¸ªå­—èŠ‚å›ºå®šï¼Œ16 ä¸ªå­—èŠ‚æ ‡è¯†è¿™æ˜¯ wma æ–‡ä»¶ï¼Œç„¶å 8 ä¸ªå­—èŠ‚å­˜å‚¨å¤´æ–‡ä»¶å¤§å°ï¼Œ4 å­—èŠ‚å­˜å‚¨å¤´æœ‰å‡ ä¸ªç»„æˆéƒ¨åˆ†ï¼Œæœ€å 2 ä¸ªæ˜¯ä¿ç•™å­—èŠ‚ã€‚

**æ ¹æ®ä¸Šé¢çš„ç»“è®ºï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°å¤´ç»„æˆéƒ¨åˆ†ä¸­çš„æ–‡ä»¶å±æ€§è¿™ä¸ªéƒ¨åˆ†å°±å¯ä»¥è§£æå‡ºæ–‡ä»¶æ—¶é•¿**

![æ–‡ä»¶å±æ€§](/images/other/å‰ç«¯jsè·å–wmaæ–‡ä»¶æ—¶é•¿/2.png)

**å®ç°æ­¥éª¤è®¾è®¡å¦‚ä¸‹**

1. æˆªå– 0-16 ä¸ªå­—èŠ‚ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º wma æ–‡ä»¶(å¦‚æœç¡®å®šä¸º wma æ–‡ä»¶å¯ä»¥çœç•¥)
2. æˆªå– 16-24 ä¸ªå­—èŠ‚ï¼Œè·å–å¤´å¯¹è±¡çš„å¤§å°
3. æ ¹æ®ç¬¬äºŒæ­¥è·å–çš„å¤´å¤§å°ï¼Œæˆªå–å¤´éƒ¨æ•°æ®
4. æ‹¿åˆ°å¤´éƒ¨äºŒè¿›åˆ¶æ•°æ®ï¼Œä» 30 ä¸ªå­—èŠ‚å¾€åï¼Œæˆªå– 16 ä¸ªå­—èŠ‚ï¼Œæ ¹æ®è¿™ 16 ä¸ªå­—èŠ‚åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶å±æ€§éƒ¨åˆ†
5. å¦‚æœæ˜¯ï¼Œæ ¹æ®å›¾äºŒçš„ç»“æ„ï¼Œè®¾ç½®åç§»é‡ï¼Œè·å–æ–‡ä»¶æ—¶é•¿äºŒè¿›åˆ¶æ•°ç»„
6. å¦‚æœä¸æ˜¯ï¼Œåˆ™å†å¾€åè¯»å– 8 ä¸ªå­—èŠ‚ï¼Œè·å–å½“å‰éƒ¨åˆ†å¤§å°
7. é€šè¿‡ç¬¬ä¸ƒæ­¥è·å–çš„å¤§å°è®¾ç½®åç§»é‡ï¼Œé‡å¤ç¬¬å››æ­¥

**ç®€å•å®ç°ä»£ç å¦‚ä¸‹**

```javascript
let input = document.getElementById('input')
input.addEventListener('change', e => {
    let file = e.target.files[0]
    file.slice(0, 16)
        .arrayBuffer()
        .then(buffer => {
            console.log(buffer)
        })
    return
    if (file && file instanceof Blob) {
        let reader = new FileReader()
        reader.onload = evt => {
            let { result } = evt.target
            console.log(result)
            // parseFile(result)
        }
        reader.readAsArrayBuffer(file.slice(0, 16))
    }
})
const FILE_PROPERTY_ID = [
    0xa1,
    0xdc,
    0xab,
    0x8c,
    0x47,
    0xa9,
    0xcf,
    0x11,
    0x8e,
    0xe4,
    0x00,
    0xc0,
    0x0c,
    0x20,
    0x53,
    0x65
]
const ID_BYTE_LEN = 16
const DURATION_OFFSET = 64
const START = 30
const BIT_LEN = 8
function parseFile(ab) {
    let uint8 = new Uint8Array(ab)
    let getFilePropertiesBytes = index => {
        let start = index
        let end = start + ID_BYTE_LEN
        let idBytes = uint8.slice(start, end)
        //idç›¸ç­‰ï¼Œåˆ™å½“å‰fram tagä¸ºæ–‡ä»¶å±æ€§
        if (idBytes.toString() === FILE_PROPERTY_ID.toString()) {
            start = start + DURATION_OFFSET
            end = start + BIT_LEN
            let durationBytes = uint8.slice(start, end)
            return toNum(durationBytes)
        } else {
            let countBytes = uint8.slice(end, end + BIT_LEN)
            let framLen = toNum(countBytes)
            start = start + framLen
            return getFilePropertiesBytes(start)
        }
    }

    let duration = getFilePropertiesBytes(START)
    console.log(duration)
}
function toNum(bytes) {
    let total = 0
    //é‡‡ç”¨çš„å°ç«¯å­˜å‚¨
    bytes.forEach((num, i) => {
        if (num > 0) {
            total += num * Math.pow(2, i * BIT_LEN)
        }
    })
    return total
}
```

å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©è¯·è¿›å…¥é“¾æ¥ (https://github.com/lingchenzheng/lingchenzheng.github.io) ç»™ä¸€ä¸ª star å§ ğŸ˜„
